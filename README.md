# üé¨ StudioBooking Backend

**StudioBooking** ‚Äî —ç—Ç–æ B2C –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ—Å—Ç—É–¥–∏–π –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ (MVP).  
–ö–ª–∏–µ–Ω—Ç—ã –∏—â—É—Ç —Å—Ç—É–¥–∏–∏, —Å–º–æ—Ç—Ä—è—Ç —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã, –±—Ä–æ–Ω–∏—Ä—É—é—Ç, –æ—Å—Ç–∞–≤–ª—è—é—Ç –æ—Ç–∑—ã–≤—ã.  
–í–ª–∞–¥–µ–ª—å—Ü—ã —É–ø—Ä–∞–≤–ª—è—é—Ç —Å—Ç—É–¥–∏—è–º–∏, –∫–æ–º–Ω–∞—Ç–∞–º–∏, –≤–∏–¥—è—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã.  
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç —Å—Ç—É–¥–∏–∏, –º–æ–¥–µ—Ä–∏—Ä—É—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –∏ —Å–º–æ—Ç—Ä—è—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- Go 1.24+ (Gin, GORM, JWT, bcrypt)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: SQLite (–ª–æ–∫–∞–ª—å–Ω–æ) + PostgreSQL (production/Docker)
- –§–∞–π–ª—ã: –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–≥–æ—Ç–æ–≤–æ –∫ S3)
- –¢–µ—Å—Ç—ã: testify (unit + mock)
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: Makefile, Docker, seed-—Å–∫—Ä–∏–ø—Ç

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.24+
- Git
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –¥–ª—è PostgreSQL)

### 1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone https://github.com/your-org/photostudio-main.git
cd photostudio-main/backend
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
go mod download
```

### 3. –ù–∞—Å—Ç—Ä–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏–µ
–°–∫–æ–ø–∏—Ä—É–π —à–∞–±–ª–æ–Ω:
```bash
cp .env.example .env
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **SQLite** ‚Äî –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!  
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å PostgreSQL ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å—Ç—Ä–æ–∫—É –≤ `.env`:
```env
# SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
DATABASE_URL=studio.db

# PostgreSQL (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –¥–ª—è Docker/production)
# DATABASE_URL=postgres://photostudio:photostudio123@localhost:5432/photostudio?sslmode=disable

# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–µ–Ω–∏ –≤ production!
JWT_SECRET=your-super-secret-jwt-key-change-me

PORT=3001
ENV=development
```

### 4. –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1 ‚Äî —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞ Windows)
go run cmd/api/main.go

# –í–∞—Ä–∏–∞–Ω—Ç 2 ‚Äî —á–µ—Ä–µ–∑ Makefile (–µ—Å–ª–∏ make —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
make dev
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞: **http://localhost:3001**  
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è —Ñ–∞–π–ª `studio.db` –∏ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (AutoMigrate).

### 5. –ó–∞–≥—Ä—É–∑–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
```bash
go run cmd/seed/main.go
# –∏–ª–∏
make seed
```

**–ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:**
- 1 –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- 3 –∫–ª–∏–µ–Ω—Ç–∞
- 3 –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å—Ç—É–¥–∏–π
- 5 —Å—Ç—É–¥–∏–π —Å 3 –∫–æ–º–Ω–∞—Ç–∞–º–∏
- 10 –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- 5 –æ—Ç–∑—ã–≤–æ–≤
- –ù–µ—Å–∫–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã** (–≤—Å–µ –ø–∞—Ä–æ–ª–∏: `client123` / `owner123` / `admin123`):

| –†–æ–ª—å               | Email                              | –ü–∞—Ä–æ–ª—å     | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|--------------------|------------------------------------|------------|-----------------------------------|
| üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä   | `admin@photostudio.kz`             | `admin123` | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏     |
| üë§ –ö–ª–∏–µ–Ω—Ç 1        | `asel@mail.kz`                     | `client123`| –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç                  |
| üë§ –ö–ª–∏–µ–Ω—Ç 2        | `bekzat@gmail.com`                 | `client123`| –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç                  |
| üë§ –ö–ª–∏–µ–Ω—Ç 3        | `dina@yandex.kz`                   | `client123`| –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç                  |
| üè¢ –í–ª–∞–¥–µ–ª–µ—Ü 1      | `aidar@lightpro.kz`                | `owner123` | –í–ª–∞–¥–µ–ª–µ—Ü –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—É–¥–∏–π       |
| üè¢ –í–ª–∞–¥–µ–ª–µ—Ü 2      | `gulnaz@creativespace.kz`          | `owner123` | –í–ª–∞–¥–µ–ª–µ—Ü —Å—Ç—É–¥–∏–π                  |
| üè¢ –í–ª–∞–¥–µ–ª–µ—Ü 3      | `yerlan@fashionstudio.kz`          | `owner123` | –í–ª–∞–¥–µ–ª–µ—Ü —Å—Ç—É–¥–∏–π                  |

> **–í–∞–∂–Ω–æ**: –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ seed-—Å–∫—Ä–∏–ø—Ç–∞ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.  
> –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—Ä—É—á–Ω—É—é –¥–ª—è –¥–µ–º–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ, —á—Ç–æ–±—ã –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ —Å—Ä–∞–∑—É.

### 6. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) PostgreSQL —á–µ—Ä–µ–∑ Docker
```bash
# –ó–∞–ø—É—Å—Ç–∏ PostgreSQL
docker-compose up -d

# –û–±–Ω–æ–≤–∏ .env (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π PostgreSQL —Å—Ç—Ä–æ–∫—É)
# DATABASE_URL=postgres://photostudio:photostudio123@localhost:5432/photostudio?sslmode=disable

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ backend
go run cmd/api/main.go
```

## üõ† –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (Makefile)

```bash
make dev       # –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
make test      # –≤—Å–µ —Ç–µ—Å—Ç—ã
make seed      # –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
make build     # —Å–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ (bin/api)
make clean     # —É–¥–∞–ª–∏—Ç—å studio.db, bin/, uploads/
```

## üîê –û—Å–Ω–æ–≤–Ω—ã–µ API Endpoints

### Auth (–ø—É–±–ª–∏—á–Ω—ã–µ)
- `POST /api/v1/auth/register/client` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- `POST /api/v1/auth/register/studio` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Å—Ç—É–¥–∏–∏
- `POST /api/v1/auth/login` ‚Äî –≤—Ö–æ–¥ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT)

### Catalog (–ø—É–±–ª–∏—á–Ω—ã–µ)
- `GET /api/v1/studios` ‚Äî —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–∏–π (—Ñ–∏–ª—å—Ç—Ä—ã: city, min_price, max_price, room_type)
- `GET /api/v1/studios/:id` ‚Äî –¥–µ—Ç–∞–ª–∏ —Å—Ç—É–¥–∏–∏
- `GET /api/v1/rooms/:id/availability?date=YYYY-MM-DD` ‚Äî —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã

### Booking (–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ)
- `POST /api/v1/bookings` ‚Äî —Å–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `GET /api/v1/users/me/bookings` ‚Äî –º–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `PATCH /api/v1/bookings/:id/payment` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã (–≤–ª–∞–¥–µ–ª–µ—Ü)
- `PATCH /api/v1/bookings/:id/status` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å (–≤–ª–∞–¥–µ–ª–µ—Ü)

### Owner (–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ, —Ä–æ–ª—å `studio_owner`)
- `GET /api/v1/studios/my` ‚Äî –º–æ–∏ —Å—Ç—É–¥–∏–∏
- `POST /api/v1/studios/:id/photos` ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Å—Ç—É–¥–∏–∏
- `GET /api/v1/studios/:id/bookings` ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–µ–π —Å—Ç—É–¥–∏–∏

### Admin (–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ, —Ä–æ–ª—å `admin`)
- `GET /api/v1/admin/studios/pending` ‚Äî —Å—Ç—É–¥–∏–∏ –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `POST /api/v1/admin/studios/:id/verify` ‚Äî –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—É–¥–∏—é
- `POST /api/v1/admin/studios/:id/reject` ‚Äî –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —Å—Ç—É–¥–∏—é
- `GET /api/v1/admin/statistics` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

## üê≥ Docker (PostgreSQL + API)

```bash
docker-compose up --build
```

- API: **http://localhost:3001**
- PostgreSQL: localhost:5432 (user: photostudio, pass: photostudio123, db: photostudio)

## üîê GitHub Secrets (CI/CD)

- `PROD_HOST`
- `PROD_USER`
- `PROD_SSH_KEY`

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
backend/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ api/         # –≥–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ seed/        # —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ database/    # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ + SQLite fallback
‚îÇ   ‚îú‚îÄ‚îÄ domain/      # –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ (User, Studio, Booking...)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/  # JWT, —Ä–æ–ª–∏, CORS
‚îÇ   ‚îú‚îÄ‚îÄ modules/     # –º–æ–¥—É–ª–∏: auth, catalog, booking, admin...
‚îÇ   ‚îú‚îÄ‚îÄ pkg/         # —É—Ç–∏–ª–∏—Ç—ã (jwt, response)
‚îÇ   ‚îî‚îÄ‚îÄ repository/  # –¥–æ—Å—Ç—É–ø –∫ –ë–î
‚îú‚îÄ‚îÄ migrations/      # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ uploads/         # –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ
‚îú‚îÄ‚îÄ studio.db        # SQLite (–≤ .gitignore)
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ Makefile
‚îî‚îÄ‚îÄ docker-compose.yml
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

- **–õ–æ–∫–∞–ª—å–Ω–æ** ‚Äî –≤—Å–µ–≥–¥–∞ SQLite (–Ω–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å PostgreSQL)
- **Production** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ PostgreSQL + Docker
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî **—Å–º–µ–Ω–∏—Ç–µ JWT_SECRET** –≤ production!
- **–¢–µ—Å—Ç—ã** ‚Äî `make test` –∏–ª–∏ `go test ./... -v`
- **–§–∞–π–ª—ã** ‚Äî –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ `./uploads/` (gitignore)

## üìå –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

- ‚úÖ MVP –∑–∞–≤–µ—Ä—à—ë–Ω
- ‚úÖ –ü–æ–ª–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–æ–ª–∏
- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–∑—ã–≤—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ Admin-–ø–∞–Ω–µ–ª—å
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–µ–π –ë–î
- ‚úÖ Docker + seed + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
